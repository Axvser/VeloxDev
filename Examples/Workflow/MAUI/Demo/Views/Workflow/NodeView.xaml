<?xml version="1.0" encoding="utf-8" ?>
<ContentView xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             x:Class="Demo.Views.Workflow.NodeView"
             xmlns:vm="clr-namespace:Demo.ViewModels"
             x:DataType="vm:NodeViewModel"
             WidthRequest="300"
             HeightRequest="300">
    <Grid>
        <Grid.RowDefinitions>
            <RowDefinition Height="12*" />
            <RowDefinition Height="90*" />
        </Grid.RowDefinitions>

        <!-- 主体区域 -->
        <Border Grid.Row="1" 
                Padding="1"
                BackgroundColor="#2d2d2d"
                Stroke="Transparent"
                StrokeShape="RoundRectangle 0,0,4,4" />

        <!-- 标题栏 -->
        <Border Grid.Row="0"
                BackgroundColor="#2d2d2d"
                Stroke="Gray"
                StrokeShape="RoundRectangle 4,4,0,0">

            <Border.GestureRecognizers>
                <PanGestureRecognizer PanUpdated="OnPanUpdated" />
                <TapGestureRecognizer Tapped="OnTapped" />
            </Border.GestureRecognizers>

            <HorizontalStackLayout HorizontalOptions="Center" VerticalOptions="Center">
                <Label Text="执行数 [ " TextColor="White" VerticalOptions="Center" />
                <Label Text="{Binding RunCount}" TextColor="White" VerticalOptions="Center" />
                <Label Text=" ] " TextColor="White" VerticalOptions="Center" />
                <Label Text="缓冲数 [ " TextColor="White" VerticalOptions="Center" />
                <Label Text="{Binding WaitCount}" TextColor="White" VerticalOptions="Center" />
                <Label Text=" ] " TextColor="White" VerticalOptions="Center" />
            </HorizontalStackLayout>
        </Border>

        <!-- 插槽区域 -->
        <Grid Grid.Row="0" Grid.RowSpan="2">
            <CollectionView ItemsSource="{Binding Slots}">
                <CollectionView.ItemsLayout>
                    <GridItemsLayout Orientation="Vertical" />
                </CollectionView.ItemsLayout>

                <CollectionView.ItemTemplate>
                    <DataTemplate x:DataType="vm:SlotViewModel">
                        <ContentView>
                            <Frame Padding="0"
                                   BackgroundColor="Transparent"
                                   HasShadow="False"
                                   HorizontalOptions="Start"
                                   VerticalOptions="Start"
                                   TranslationX="{Binding Offset.Left}"
                                   TranslationY="{Binding Offset.Top}">

                                <ContentView WidthRequest="{Binding Size.Width}"
                                             HeightRequest="{Binding Size.Height}">
                                    <!-- 这里放置您的SlotView内容 -->
                                </ContentView>
                            </Frame>
                        </ContentView>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </Grid>
    </Grid>
</ContentView>
